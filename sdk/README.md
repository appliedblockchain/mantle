# Mantle

Mantle is a blockchain SDK that intends to simplify the development process when writing code for chains. Mantle comprises both a client and server side sdk, that when combined help to facilitate a host of tasks such as secure data storage on IPFS for GDPR compliance, sending signed transactions, transaction nonce recording etc.

# Features

-   In-built Hierarchical Deterministic (HD) wallet to manage your private/public key pairs
-   Key/Wallet recovery
-   Separate key pairs for encryption and signing
-   Encryption and decryption helpers using Elliptic Curve Cryptography (ECC)
-   Transaction signing
-   Token management
-   Web3 wrapper

# Getting Started

`npm i`

`const Mantle = require('@appliedblockchain/mantle-core)`

### `Initialising a new Mantle instance:`

`const mantle = new Mantle()`

The mantle instance exposes methods to facilitate, amongst other things, mnemonic and HD public/private key generation, IPFS API access etc.

### `Configuring Mantle`

Mantle accepts a configuration object on instantiation, as below:

```js
const mantle = new Mantle({
  provider: 'http://localhost:8545', // parity address
  proxyURL: 'http://localhost:3000/api', // proxy address for IPFS/Transaction calls
  contracts: [ {
    name: 'foo',
    address: '0xde0B295669a9FD93d5F28D9Ec85E40f4cb697BAe',
    abi: [ {
      type: 'function',
      name: 'foo',
      constant: false,
      payable: false,
      stateMutability: 'nonpayable',
      inputs: [ { 'name': 'b', 'type': 'uint256' }, { 'name': 'c', 'type': 'bytes32' } ],
      outputs: [ { 'name': '', 'type': 'address' } ]
    } ]
  } ] // contract interfaces - automatically instantiated onto web3 if provided
  tokens: {
    ERC20: [
      { name: 'TokenName', address: '0x...'} // Will use the default ERC20 abi present in mantle, but a custom abi can be passed here as well
    ]
  },
})
```

### `Mnemonic generation`

Mnemonic, HD private/public keys and private/public keys are generated via `loadMnemonic`. Supply a mnemonic associated with an existing account in order to retrieve key information, or supply no argument in order to generate a new set of keys.

```js
mantle.mnemonic // undefined

mantle.loadMnemonic() // No argument supplied - used for new accounts

mantle.mnemonic // 'knife zone arch average surround tape napkin elephant share fuel jeans false'

mantle.removeKeys()
mantle.mnemonic // null

mantle.loadMnemonic('tragic panic toast hazard royal marine visual laptop salmon guard finger upper') // Mnemonc supplied - should be used to load existing keys
```

### `Symmetric encryption/decryption`

Facilitated via the `encryptSymmetric` and `decryptSymmetric` static methods. Shared secrets can be generated via `createSymmetricKey`.

```js
const data = 'foo'
const secret = Mantle.createSymmetricKey()

const encrypted = Mantle.encryptSymmetric(data, secret) // Returns a Buffer

const decrypted = Mantle.decryptSymmetric(encrypted, secret) // 'foo'
```

### `Asymmetric encryption/decryption`

Facilitated via the `Mantle.encrypt` and `Mantle.decrypt` static methods, or the `mantle.decrypt` instance method

```js
const data = 'foo'

const encrypted = Mantle.encrypt(data, mantle.publicKey) // Returns a buffer

const decrypted = Mantle.decrypt(encrypted, mantle.privateKey) || mantle.decrypt(encrypted) // 'foo'
```

### `Tokens`

If your configuration defines one or multiple tokens they will be loaded automatically. The first token will become the defaultToken accessible via `mantle.defaultToken`. Other tokens can be accessed via `mantle.tokens.TokenName`.

Each token also has two convenience methods: `getBalance(address)` with address defaulting to mantle.address and `sendTokens(address, amount)`. The default token getBalance and sendTokens methods are also aliased directly to `mantle.getBalance()` and `mantle.sendTokens(...)`.

### `Proxy`

Mantle hooks into server-side middleware for processing IPFS requests and transaction signing (simply set the proxyURL in the Mantle configuration object). We supply a set of ready to go middleware from [mantle-server](https://github.com/appliedblockchain/mantle/tree/master/server-sdk) or you can hook into your own.

# API Docs

`npm run build-docs`

A `docs` folder will be created in the project root with an `index.html` file that can be opened on your local machine

# API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Mantle](#mantle)
    -   [signTransaction](#signtransaction)
        -   [Parameters](#parameters)
    -   [sendSignedTransaction](#sendsignedtransaction)
        -   [Parameters](#parameters-1)
    -   [loadContracts](#loadcontracts)
        -   [Parameters](#parameters-2)
    -   [loadContract](#loadcontract)
        -   [Parameters](#parameters-3)
    -   [loadTokens](#loadtokens)
        -   [Parameters](#parameters-4)
    -   [loadToken](#loadtoken)
        -   [Parameters](#parameters-5)
    -   [Web3](#web3)
    -   [connect](#connect)
    -   [setupWeb3Provider](#setupweb3provider)
    -   [decrypt](#decrypt)
        -   [Parameters](#parameters-6)
    -   [loadMnemonic](#loadmnemonic)
        -   [Parameters](#parameters-7)
    -   [deriveEthereumAddresses](#deriveethereumaddresses)
    -   [derivePrivateKeys](#deriveprivatekeys)
        -   [Parameters](#parameters-8)
    -   [derivePublicKeys](#derivepublickeys)
    -   [removeKeys](#removekeys)
    -   [getPublicKey](#getpublickey)
        -   [Parameters](#parameters-9)
    -   [getPrivateKey](#getprivatekey)
        -   [Parameters](#parameters-10)
    -   [getEncPublicKey](#getencpublickey)
        -   [Parameters](#parameters-11)
    -   [getEncPrivateKey](#getencprivatekey)
        -   [Parameters](#parameters-12)
    -   [getSigPublicKey](#getsigpublickey)
        -   [Parameters](#parameters-13)
    -   [getSigPrivateKey](#getsigprivatekey)
        -   [Parameters](#parameters-14)
    -   [address](#address)
    -   [privateKey](#privatekey)
    -   [publicKey](#publickey)
    -   [Web3](#web3-1)
    -   [generateHash](#generatehash)
        -   [Parameters](#parameters-15)
    -   [generateMnemonic](#generatemnemonic)
    -   [createSymmetricKey](#createsymmetrickey)
    -   [encrypt](#encrypt)
        -   [Parameters](#parameters-16)
    -   [decrypt](#decrypt-1)
        -   [Parameters](#parameters-17)
    -   [encryptSymmetric](#encryptsymmetric)
        -   [Parameters](#parameters-18)
    -   [decryptSymmetric](#decryptsymmetric)
        -   [Parameters](#parameters-19)
    -   [sign](#sign)
        -   [Parameters](#parameters-20)
    -   [recover](#recover)
        -   [Parameters](#parameters-21)
    -   [recoverAddress](#recoveraddress)
        -   [Parameters](#parameters-22)
    -   [utils](#utils)
-   [Config](#config)
    -   [\_validateConfig](#_validateconfig)
        -   [Parameters](#parameters-23)
    -   [\_validateBlockchain](#_validateblockchain)
        -   [Parameters](#parameters-24)
    -   [\_validateContracts](#_validatecontracts)
        -   [Parameters](#parameters-25)
-   [IPFS](#ipfs)
    -   [pinLs](#pinls)
        -   [Parameters](#parameters-26)
    -   [retrieve](#retrieve)
        -   [Parameters](#parameters-27)
    -   [remove](#remove)
        -   [Parameters](#parameters-28)
    -   [store](#store)
        -   [Parameters](#parameters-29)
-   [bytesToBuffer](#bytestobuffer)
    -   [Parameters](#parameters-30)
-   [bufferToOther](#buffertoother)
    -   [Parameters](#parameters-31)
-   [bufferToHex](#buffertohex)
    -   [Parameters](#parameters-32)
-   [bufferToHex0x](#buffertohex0x)
    -   [Parameters](#parameters-33)

## Mantle

### signTransaction

#### Parameters

-   `options` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `options.contractName` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
    -   `options.methodName` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
    -   `options.params` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
    -   `options.nonce` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** 
    -   `options.chainId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** 

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### sendSignedTransaction

#### Parameters

-   `rawTransaction` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

### loadContracts

#### Parameters

-   `contracts` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

Returns **void** 

### loadContract

Generate a Contract instance and attach it to our
contracts object using a unique Contract name as the key

#### Parameters

-   `contract` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **Contract** 

### loadTokens

#### Parameters

-   `tokens` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

Returns **void** 

### loadToken

Generate a Contract instance and attach it to our
contracts object using a unique Contract name as the key

#### Parameters

-   `token` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `token.name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The token name
    -   `token.address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The token address
    -   `token.abi` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The token abi, optional since mantle contain a default ERC20 token

Returns **void** 

### Web3

Returns **Web3** 

### connect

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

### setupWeb3Provider

Returns **void** 

### decrypt

Data decryption using instance's private key

#### Parameters

-   `data` **([Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String))** 

Returns **any** 

### loadMnemonic

Derive a mnemonic/HD private key from the supplied seed (if applicable). If no
seed is provided, then create a new mnemonic (this is exposed as mantle.mnemonic).
The HD private key can be used to derive a HD public key and, later, private/public key pairs

#### Parameters

-   `seed` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** A 12 word mnemonic that acts as a seed in order to recover account information (optional) (optional, default `null`)

Returns **void** 

### deriveEthereumAddresses

Derive checksum addresses from our private keys

Returns **void** 

### derivePrivateKeys

Derive private keys from our HDPrivateKey

#### Parameters

-   `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** =0 (optional, default `0`)

Returns **void** 

### derivePublicKeys

Derive public keys from our private keys

Returns **void** 

### removeKeys

Reset keys associated with the mantle instance

Returns **void** 

### getPublicKey

#### Parameters

-   `format` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ='buffer' (optional, default `'buffer'`)

Returns **([buffer](https://nodejs.org/api/buffer.html) | hex | hex0x)** 

### getPrivateKey

#### Parameters

-   `format` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ='buffer' (optional, default `'buffer'`)

Returns **([buffer](https://nodejs.org/api/buffer.html) | hex | hex0x)** 

### getEncPublicKey

#### Parameters

-   `format` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ='buffer' (optional, default `'buffer'`)

Returns **([buffer](https://nodejs.org/api/buffer.html) | hex | hex0x)** 

### getEncPrivateKey

#### Parameters

-   `format` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ='buffer' (optional, default `'buffer'`)

Returns **([buffer](https://nodejs.org/api/buffer.html) | hex | hex0x)** 

### getSigPublicKey

#### Parameters

-   `format` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ='buffer' (optional, default `'buffer'`)

Returns **([buffer](https://nodejs.org/api/buffer.html) | hex | hex0x)** 

### getSigPrivateKey

#### Parameters

-   `format` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ='buffer' (optional, default `'buffer'`)

Returns **([buffer](https://nodejs.org/api/buffer.html) | hex | hex0x)** 

### address

Returns **hex0x** 

### privateKey

Returns **[buffer](https://nodejs.org/api/buffer.html)** 

### publicKey

Returns **[buffer](https://nodejs.org/api/buffer.html)** 

### Web3

Returns **Web3** 

### generateHash

Generates hash from arguments

#### Parameters

-   `args` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>** 1 or more arguments to generate hash from (can be of type: String, Number or Boolean)

Returns **hex0x** 

### generateMnemonic

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** A 12 word mnemonic

### createSymmetricKey

Create a key used for symmetric encryption/decryption

Returns **[buffer](https://nodejs.org/api/buffer.html)** A 32 byte buffer

### encrypt

Data encryption using public key

#### Parameters

-   `data` **([Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String))** 
-   `publicKey` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[buffer](https://nodejs.org/api/buffer.html)** 

### decrypt

Data decryption using private key

#### Parameters

-   `data` **([Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String))** 
-   `privateKey` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **any** 

### encryptSymmetric

#### Parameters

-   `data` **any** Any JSON serializable value
-   `secret` **byte** A 32 byte secret

Returns **[buffer](https://nodejs.org/api/buffer.html)** A 16 byte initialization vector followed by encrypted data

### decryptSymmetric

#### Parameters

-   `data` **[blob](https://developer.mozilla.org/docs/Web/API/Blob)** A 16 byte initialization vector followed by encrypted data
-   `secret` **byte** A 32 byte secret

Returns **any** A decrypted value

### sign

Create an ECDSA signature from a 32-byte buffer by applying secp256k1's signature generation algorithm

Our signature composes of:

-   32-byte scalar `r` (part of the ECDSA signature)
-   32-byte scalar `s` (part of the ECDSA signature)
-   A recovery id `v` used for public key recovery

#### Parameters

-   `data` **([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean) \| [Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number) \| [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>)** Single value or array of values to sign
-   `privateKey` **[buffer](https://nodejs.org/api/buffer.html)** 

Returns **hex0x** 

### recover

Recovers public key from a message hash and ECDSA signature

#### Parameters

-   `hash` **hex0x** 
-   `ecSignature` **hex0x** An ECDSA generated signature

Returns **hex0x** 

### recoverAddress

#### Parameters

-   `hash` **hex0x** 
-   `ecSignature` **hex0x** 

Returns **hex0x** 

### utils

Returns **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## Config

### \_validateConfig

#### Parameters

-   `config` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **void** 

### \_validateBlockchain

#### Parameters

-   `blockchain` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **void** 

### \_validateContracts

All contracts need an identifier and JSON interface (defined by the ABI).
Contract addresses are optional.

#### Parameters

-   `contracts` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **void** 

## IPFS

### pinLs

#### Parameters

-   `hash` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

### retrieve

#### Parameters

-   `hash` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[buffer](https://nodejs.org/api/buffer.html)** 

### remove

Removes data from IPFS by unpinning the hash and then running
the IPFS garbage collector

#### Parameters

-   `hash` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **void** 

### store

Stores data on IPFS and pins the hash to the pinset

#### Parameters

-   `data` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

## bytesToBuffer

### Parameters

-   `value` **([buffer](https://nodejs.org/api/buffer.html) | hex0x | hex)** 

Returns **[buffer](https://nodejs.org/api/buffer.html)** 

## bufferToOther

### Parameters

-   `buffer` **[buffer](https://nodejs.org/api/buffer.html)** 
-   `format` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** ='buffer' (optional, default `'buffer'`)

Returns **([buffer](https://nodejs.org/api/buffer.html) | hex | hex0x)** 

## bufferToHex

### Parameters

-   `data` **[buffer](https://nodejs.org/api/buffer.html)** 

Returns **hex** 

## bufferToHex0x

### Parameters

-   `data` **[buffer](https://nodejs.org/api/buffer.html)** 

Returns **hex0x** 
